<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>ronda.schema.middleware documentation</title></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">ronda/schema 0.1.2 API documentation</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ronda</span></div></div></li><li class="depth-2"><a href="ronda.schema.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>schema</span></div></a></li><li class="depth-3 branch"><a href="ronda.schema.coercer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coercer</span></div></a></li><li class="depth-3"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>data</span></div></div></li><li class="depth-4 branch"><a href="ronda.schema.data.request.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>request</span></div></a></li><li class="depth-4"><a href="ronda.schema.data.response.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>response</span></div></a></li><li class="depth-3 branch current"><a href="ronda.schema.middleware.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="ronda.schema.request.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>request</span></div></a></li><li class="depth-3"><a href="ronda.schema.response.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>response</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="ronda.schema.middleware.html#var-as-response"><div class="inner"><span>as-response</span></div></a></li><li class="depth-1"><a href="ronda.schema.middleware.html#var-error-.3Eresponse"><div class="inner"><span>error-&gt;response</span></div></a></li><li class="depth-1"><a href="ronda.schema.middleware.html#var-error-.3Eresponse-body"><div class="inner"><span>error-&gt;response-body</span></div></a></li><li class="depth-1"><a href="ronda.schema.middleware.html#var-error-.3Estatus"><div class="inner"><span>error-&gt;status</span></div></a></li><li class="depth-1"><a href="ronda.schema.middleware.html#var-handle-with-validation"><div class="inner"><span>handle-with-validation</span></div></a></li><li class="depth-1"><a href="ronda.schema.middleware.html#var-Options"><div class="inner"><span>Options</span></div></a></li><li class="depth-1"><a href="ronda.schema.middleware.html#var-validation-error"><div class="inner"><span>validation-error</span></div></a></li><li class="depth-1"><a href="ronda.schema.middleware.html#var-wrap-schema"><div class="inner"><span>wrap-schema</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">ronda.schema.middleware</h2><div class="doc"><div class="markdown"></div></div><div class="public anchor" id="var-as-response"><h3>as-response</h3><div class="usage"><code>(as-response result)</code></div><div class="doc"><div class="markdown"><p>Inputs: [result :- (s/either ring/Response e/ValidationError)] Returns: (s/maybe ring/Response)</p><p>If <code>result</code> is an error, return default error response, the response  otherwise.</p></div></div><div class="src-link"><a href="https://github.com/xsc/ronda-schema/blob/master/src/ronda/schema/middleware.clj#L94">view source</a></div></div><div class="public anchor" id="var-error-.3Eresponse"><h3>error-&gt;response</h3><div class="usage"><code>(error-&gt;response error)</code></div><div class="doc"><div class="markdown"><p>Inputs: [error :- e/ValidationError]</p><p>Convert error result to response map.</p></div></div><div class="src-link"><a href="https://github.com/xsc/ronda-schema/blob/master/src/ronda/schema/middleware.clj#L44">view source</a></div></div><div class="public anchor" id="var-error-.3Eresponse-body"><h3>error-&gt;response-body</h3><div class="usage"><code>(error-&gt;response-body {:keys [error error-form]})</code></div><div class="doc"><div class="markdown"><p>Inputs: [{:keys [error error-form]} :- e/ValidationError] Returns: s/Str</p><p>Convert error result to response body.</p></div></div><div class="src-link"><a href="https://github.com/xsc/ronda-schema/blob/master/src/ronda/schema/middleware.clj#L39">view source</a></div></div><div class="public anchor" id="var-error-.3Estatus"><h3>error-&gt;status</h3><div class="usage"><code>(error-&gt;status {:keys [error]})</code></div><div class="doc"><div class="markdown"><p>Inputs: [{:keys [error]} :- e/ValidationError] Returns: ring/Status</p><p>Convert error result to response status.</p></div></div><div class="src-link"><a href="https://github.com/xsc/ronda-schema/blob/master/src/ronda/schema/middleware.clj#L30">view source</a></div></div><div class="public anchor" id="var-handle-with-validation"><h3>handle-with-validation</h3><div class="usage"><code>(handle-with-validation handler schema request)</code><code>(handle-with-validation handler schema request options)</code></div><div class="doc"><div class="markdown"><p>Inputs: ([handler :- ring/Handler schema :- rq/Requests request :- ring/Request] [handler :- ring/Handler schema :- rq/Requests request :- ring/Request options :- Options]) Returns: (s/maybe ring/Response)</p><p>Process the given request:</p>
<ul>
  <li>validate request against schema,</li>
  <li>handle coerced request,</li>
  <li>validate response,</li>
  <li>return coerced response.</li>
</ul><p>If a validation error is encountered, an error response will be generated  that contains the raw error value, accessible using <code>validation-error</code>.</p><p>Note that this function takes a compiled request schema attainable using  <code>ronda.schema/compile-requests</code>.</p></div></div><div class="src-link"><a href="https://github.com/xsc/ronda-schema/blob/master/src/ronda/schema/middleware.clj#L102">view source</a></div></div><div class="public anchor" id="var-Options"><h3>Options</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>Options for <code>wrap-schema</code>.</p></div></div><div class="src-link"><a href="https://github.com/xsc/ronda-schema/blob/master/src/ronda/schema/middleware.clj#L17">view source</a></div></div><div class="public anchor" id="var-validation-error"><h3>validation-error</h3><div class="usage"><code>(validation-error response)</code></div><div class="doc"><div class="markdown"><p>Inputs: [response :- ring/Response] Returns: (s/maybe e/ValidationError)</p><p>Get the validation error from the response (or <code>nil</code>).</p></div></div><div class="src-link"><a href="https://github.com/xsc/ronda-schema/blob/master/src/ronda/schema/middleware.clj#L52">view source</a></div></div><div class="public anchor" id="var-wrap-schema"><h3>wrap-schema</h3><div class="usage"><code>(wrap-schema handler request-schema)</code><code>(wrap-schema handler request-schema {:keys [response? coercer], :or {response? true, coercer rc/default-coercer-factory}, :as options})</code></div><div class="doc"><div class="markdown"><p>Inputs: ([handler :- ring/Handler request-schema :- rq/RawRequests] [handler :- ring/Handler request-schema :- rq/RawRequests {:keys [response? coercer], :or {response? true, coercer rc/default-coercer-factory}, :as options} :- Options]) Returns: ring/Handler</p><p>Wrap the given handler with request/response validation against the given  request schema.</p></div></div><div class="src-link"><a href="https://github.com/xsc/ronda-schema/blob/master/src/ronda/schema/middleware.clj#L131">view source</a></div></div></div></body></html>